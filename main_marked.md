# turnover-bot: main.py (размеченная версия)

Этот документ — “эталон” `main.py`, разбитый на небольшие блоки, чтобы дальше мы могли менять **целиком блоками**.

## Оглавление блоков

**1A — Импорты и базовые настройки**  
**1B — Загрузка переменных окружения**  
**1C — Константы и словари нормализации**  

**2A — Нормализация: snake_case, bool/num/date**  
**2B — Преобразование строки DataFrame → payload (jsonb)**  

**3A — БД: connect/exec/fetchone**  
**3B — Миграции: создать таблицу и добавить недостающие колонки**  
**3C — Upsert DataFrame в БД (все поля → payload)**  

**4A — Сборка приложения (Dispatcher)**  
**4B — `/start`**  
**4C — `/db`**  

**5A — Приём `.xlsx`: скачивание во временный файл**  
**5B — Чтение Excel и проверки**  
**5C — Загрузка в БД и ответ пользователю**  

**6A — Fallback/debug (на всё непойманное)**  
**6B — Запуск polling**  